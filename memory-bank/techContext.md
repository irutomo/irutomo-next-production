# テクノロジーコンテキスト - irutomo222レストラン予約システム

## 技術スタック

### フロントエンド
- ✅ **フレームワーク**: Next.js 15.2 (App Router)
- ✅ **言語**: TypeScript 5.4
- ✅ **UIライブラリ**: React 19
- ✅ **スタイリング**: Tailwind CSS 4.0
- ✅ **UIコンポーネント**: Shadcn UI (TailwindベースのヘッドレスUIコンポーネント)
- ✅ **フォーム管理**: React Hook Form + Zod
- ✅ **データ取得・状態管理**: TanStack Query (クライアント側) + Server Components (サーバー側)
- ✅ **アニメーション**: Framer Motion
- ✅ **国際化**: next-intl
- ✅ **日付/時間処理**: date-fns
- ✅ **アイコン**: Lucide Icons
- ✅ **地図表示**: Mapbox
- ✅ **チャート**: Recharts

### バックエンド
- ✅ **データベース**: Supabase (PostgreSQL)
- ✅ **認証**: Clerk
- ✅ **API**: Next.js Server Actions & API Routes
- ✅ **ファイルストレージ**: Supabase Storage
- ✅ **決済処理**: PayPal API
- ✅ **画像最適化**: Next.js Image Optimization

### 開発ツール
- ✅ **パッケージ管理**: npm
- ✅ **コード品質**: ESLint, Prettier
- ✅ **Git管理**: GitHub
- ✅ **CI/CD**: GitHub Actions, Vercel
- ✅ **テスト**: Vitest, Testing Library, Playwright
- ✅ **開発サーバー**: Next.js + Turbopack
- ✅ **アクセシビリティ**: axe-core

### デプロイ
- ✅ **ホスティング**: Vercel
- ✅ **コンテンツ配信**: Vercel Edge Network
- ✅ **分析**: Vercel Analytics
- ✅ **モニタリング**: Sentry

## Next.js 15.2 - 主要な更新点と利用機能

### 新機能の活用

1. **App Router (ページルーター完全移行済)**
   - ✅ サーバーコンポーネントをフル活用
   - ✅ レイアウト、テンプレート、ローディングUI
   - ✅ 静的/動的レンダリングの最適な組み合わせ
   - ✅ メタデータAPI活用
   - ✅ Streaming SSR
   - ✅ Parallel Routes
   - ✅ Intercepting Routes

2. **Server Components**
   - ✅ バンドルサイズの削減
   - ✅ データベースへの直接アクセス
   - ✅ バックエンドリソースへの安全なアクセス
   - ✅ APIレイヤーの削減

3. **Server Actions**
   - ✅ フォーム処理
   - ✅ データベーストランザクション
   - ✅ ミューテーション処理
   - ✅ Progressive Enhancement

4. **高度なルーティング**
   - ✅ パラレルルート - 複数ビューの同時表示
   - ✅ インターセプトルート - モーダル/スライドオーバー
   - ✅ ルートグループ - 論理的なルート分割

5. **新パフォーマンス機能**
   - ✅ 部分プリレンダリング (PPR) - 評価中
   - ✅ View Transition API - アニメーションに活用
   - ✅ Turbopack開発サーバー - 高速HMR
   - ✅ メタデータのストリーミング

### セキュリティ強化
- ✅ CSP強化対応
- ✅ セキュアヘッダー対応
- ✅ 信頼性の高い環境変数処理

## Clerk認証の活用

### 最新の認証フロー
- ✅ Clerk認証システム (v5)
- ✅ セッショントークン認証（JWTテンプレート方式から移行）
  - 2025年4月1日より、JWTテンプレート方式は公式に非推奨化
- ✅ Clerkダッシュボードの「Connect with Supabase」機能を使用
- ✅ RLS (Row Level Security)との完全統合
- ✅ Server Action内での認証チェック
- ✅ バックグラウンドトークンリフレッシュ

### 実装パターン
- ✅ 個々のコンポーネントでのアクセス制御
- ✅ ミドルウェアによるルート保護
- ✅ サーバーコンポーネントでのユーザー情報アクセス
- ✅ クライアントコンポーネントでのユーザー情報アクセス
- ✅ トークンキャッシュとパフォーマンス最適化

## Supabaseの活用

### データベース機能
- ✅ PostgreSQLデータベース
- ✅ RLS（Row Level Security）ポリシー
- ✅ 外部キー制約
- ✅ サーバーサイドでの直接クエリ

### ストレージ
- ✅ レビュー画像保存
- ✅ レストラン画像保存
- ✅ RLSによるアクセス制御
- ✅ 画像変換とサイズ最適化

### サーバーアクションでの活用
- ✅ セッション検証
- ✅ トランザクション
- ✅ 型安全なデータアクセス
- ✅ エラーハンドリング

## PayPal統合

### 実装状況
- ✅ PayPal APIとの統合
- ✅ 公式React SDK (@paypal/react-paypal-js)
- ✅ サンドボックス環境設定
- ✅ 予約金支払いフロー

### セキュリティ対策
- ✅ Server Actionsによる安全な決済処理
- ✅ トランザクション検証
- ✅ エラー処理とリカバリー
- ✅ セッション管理の最適化

### 機能
- ✅ 予約時のデポジット支払い
- ✅ 複数通貨対応
- ✅ モバイル最適化表示
- ✅ 支払い完了通知

## Tailwind CSSの活用

### 使用スタイリング手法
- ✅ ユーティリティファーストアプローチ
- ✅ カスタムテーマ設定
- ✅ ダークモードサポート
- ✅ コンポーネント固有のスタイリング
- ✅ レスポンシブデザイン

### 拡張機能
- ✅ tailwindcss-animate（アニメーション）
- ✅ @tailwindcss/forms（フォーム要素）
- ✅ @tailwindcss/typography（コンテンツスタイリング）
- ✅ Autoprefixer

## Shadcn UIの活用

### コンポーネント使用状況
- ✅ 基本UIコンポーネント（Button, Input, Card等）
- ✅ フォームコンポーネント（Form, Select, Checkbox等）
- ✅ ナビゲーションコンポーネント（Tabs, Pagination等）
- ✅ フィードバックコンポーネント（Toast, Alert等）
- ✅ オーバーレイコンポーネント（Dialog, Sheet等）

### カスタマイズ
- ✅ カラースキームのブランド調整
- ✅ アニメーションのカスタマイズ
- ✅ コンポーネント拡張
- ✅ アクセシビリティの強化

## テスト戦略

### 単体テスト
- ✅ Vitest + React Testing Library
- ✅ コンポーネントのテスト
- ✅ ユーティリティ関数のテスト
- ✅ カスタムフックのテスト

### 統合テスト
- ✅ Server Actionsのテスト
- ✅ APIルートのテスト
- ✅ データフローのテスト

### E2Eテスト
- ✅ Playwrightによるエンドツーエンドテスト
- ✅ 主要ユーザーフローのテスト
- ✅ クロスブラウザテスト

## データフェッチ戦略

### サーバーサイド
- ✅ Server Componentsでの直接データフェッチ
- ✅ Supabase Clientを使用した型安全なクエリ
- ✅ キャッシュとリバリデーション

### クライアントサイド
- ✅ TanStack Query
- ✅ 最適なキャッシュ戦略
- ✅ SWRパターン（Stale-While-Revalidate）
- ✅ 楽観的UI更新

## サーバーアクション活用

### セキュリティ
- ✅ CSRFトークン自動保護
- ✅ サーバーサイドバリデーション
- ✅ 認証チェック
- ✅ エラーハンドリング

### パフォーマンス
- ✅ サーバーサイドのみで実行される重い処理
- ✅ キャッシュの再検証
- ✅ 楽観的UI更新との連携

### フォーム処理
- ✅ React Hook Formとの連携
- ✅ バリデーションエラーのクライアントへの返却
- ✅ マルチステップフォームでの状態保持
- ✅ 進行状況の表示

## パフォーマンス最適化

### 画像最適化
- ✅ next/imageによる自動最適化
- ✅ 遅延ロード
- ✅ WebPフォーマットの活用
- ✅ 適切なサイズでの提供

### コード最適化
- ✅ バンドルサイズの最小化
- ✅ コード分割
- ✅ 動的インポート
- ✅ 未使用コードの削除（ツリーシェイキング）

### レンダリング最適化
- ✅ 適切なレンダリング戦略の選択
- ✅ ストリーミングによるプログレッシブレンダリング
- ✅ React.memo、useMemo、useCallbackの適切な使用
- ✅ 不要な再レンダリングの回避

### キャッシュ戦略
- ✅ ISRキャッシュ
- ✅ ルートセグメントごとのキャッシュ制御
- ✅ 動的レンダリングとキャッシングの組み合わせ
- ✅ キャッシュタグによる選択的再検証

## アクセシビリティ対応

### 実装状況
- ✅ スクリーンリーダー対応
- ✅ キーボードナビゲーション
- ✅ 色コントラスト対応
- ✅ フォーカス管理
- ✅ ARIA属性の適切な使用

### テスト
- ✅ axe-coreによる自動テスト
- ✅ キーボードナビゲーションテスト
- ✅ スクリーンリーダーテスト
- ✅ カラーコントラストチェック

## レスポンシブデザイン

### 実装アプローチ
- ✅ モバイルファーストデザイン
- ✅ Tailwindブレイクポイントの活用
- ✅ コンテナクエリの使用
- ✅ メディアクエリのカスタマイズ

### テスト
- ✅ 複数デバイスサイズでのテスト
- ✅ ブラウザ互換性テスト
- ✅ 実機でのテスト
- ✅ レスポンシブデザインツールでの検証

## 国際化（i18n）

### 実装状況
- ✅ next-intlによる翻訳管理
- ✅ 日本語・英語対応
- ✅ 日付、時間、通貨のローカライズ
- ✅ メッセージの多言語化

### 機能
- ✅ 言語切り替え
- ✅ URLベースの言語指定
- ✅ ブラウザ言語検出
- ✅ フォールバック言語設定

## 開発環境とツール

### 開発環境
- ✅ Next.js開発サーバー + Turbopack
- ✅ ホットモジュールリプレイスメント（HMR）
- ✅ ESLint + Prettierの統合
- ✅ TypeScriptタイプチェック

### デバッグツール
- ✅ Next.jsデバッグモード
- ✅ React Developer Tools
- ✅ Chrome DevTools
- ✅ Supabaseダッシュボード

### コード品質
- ✅ TypeScript厳格モード
- ✅ ESLintカスタムルール
- ✅ CIでの自動チェック
- ✅ コードレビュープロセス

## デプロイプロセス

### 環境
- ✅ 開発環境（開発者ローカル）
- ✅ テスト環境（PRごとのプレビュー）
- ✅ ステージング環境
- ✅ 本番環境

### CI/CD
- ✅ GitHub Actionsによる自動化
- ✅ テスト自動実行
- ✅ Vercelへの自動デプロイ
- ✅ デプロイ前後のチェック

### モニタリング
- ✅ Vercel Analyticsによるパフォーマンスモニタリング
- ✅ Sentryによるエラートラッキング
- ✅ ログ収集と分析
- ✅ アラート設定

## 今後検討中の技術

### 追加検討技術
- AWS S3への画像保存移行
- Server-Sent Events (SSE)によるリアルタイム通知
- SVGアニメーションの強化
- PWA対応

### パフォーマンス向上
- 部分プリレンダリング (PPR)の本格導入
- サーバーコンポーネントの最適化
- Edge Runtimeの活用
- オンデマンドISR

### ツール強化
- Storybookの導入
- APIドキュメント自動生成
- パフォーマンスモニタリングの強化
- A/Bテスト基盤

### セキュリティ強化
- セキュリティスキャンの自動化
- 認証フローの継続的強化
- CSPポリシーの継続的改善
- セキュリティトレーニングとレビュー 